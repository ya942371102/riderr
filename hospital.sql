create schema hospital;
use hospital;
 
create table department
(
  dpname char(10) not null unique,
  dpno char(1) primary key,
  dpadr char(20),
  dptel char(20)
);
create table doctor
(
  dno char(3) primary key,
  dname char(20),
  duty char(20),
  dsex bit(1),
  dage int check (page>=0 and page <=150),
  dpno char(1),
  foreign key (dpno) references department(dpno)
);
create table room
(
  rno char(10) primary key ,
  radr char(20) unique,
  dpno char(5),
  foreign key (dpno) references department(dpno)
);
create table patient
(
  pno char(20) primary key,
  pname char(20) not null,
  psex bit(1),
  page int check (page>=0 and page <=150),
  dno char(3),
  rno char(10),
  illness char(20),
  startdate date,
  predictenddate date,
  foreign key (dno) references doctor(dno),
  foreign key (rno) references room(rno)
);
create table nurse
(
  nno char(2) primary key ,
  nname char(10) unique ,
  nsex bit(1),
  nage int
);
create table PN
(
  pno char(20),
  nno char(2),
  content char(20),
  time datetime,
  foreign key (pno) references patient(pno),
  foreign key (nno) references nurse(nno)
);
create table drug
(
  dgno char(4) primary key ,
  dgname char(20),
  dgpro char(20),
  dgnum int check(dgnum>=0),
  dgprice int check(dgprice>=0)
);
create table PD
(
  dgno char(4),
  pno char(4),
  num int check(num>=0),
  foreign key (dgno) references drug(dgno),
  foreign key (pno)  references patient(pno),
  primary key (dgno,pno)
);
 
insert into department values("内科","1","一号楼514","04512340987"),
                             ("外科","2","二号楼202","04514521234"),
                             ("妇科","3","一号楼421","04510987654"),
                             ("儿科","4","三号楼628","04511234567"),
                             ("神经科","5","一号楼555","04519283746"),
                             ("精神科","6","隔离所一栋01","04510987890"),
                             ("五官科","7","三号楼101","04511029281"),
                             ("放射线科","8","隔离所二栋11","04518888888"),
                             ("检验科","9","二号楼456","04518787878");
insert into doctor values ("101","李小明","中级医师",1,18,"1"),
                          ("102","赵二猫","正高级医师",1,56,"1"),
                          ("103","陈仁义","初级医师",0,20,"1"),
                          ("201","陈省","初级医师",0,21,"2"),
                          ("202","王雪清","副高级医师",0,32,"2"),
                          ("203","赵彩结","正高级医师",0,50,"2"),
                          ("301","王鹤男","中级医师",0,20,"3"),
                          ("302","王风","初级医师",0,31,"3"),
                          ("303","李文革","正高级医师",0,51,"3"),
                          ("401","钱求和","初级医师",0,24,"4"),
                          ("402","陈少杰","中级医师",1,26,"4"),
                          ("403","拉普拉斯","正高级医师",1,59,"4"),
                          ("501","赵意识","初级医师",0,31,"5"),
                          ("502","陈打野","中级医师",1,29,"5"),
                          ("503","欧上路","初级医师",1,31,"5"),
                          ("601","陈小希","初级医师",0,51,"6"),
                          ("602","陈欧皇","中级医师",1,29,"6"),
                          ("603","傅杰","副高级医师",0,46,"6"),
                          ("701","赵梦啥","初级医师",1,59,"7"),
                          ("702","王来文","正高级医师",1,32,"7"),
                          ("703","傅出","副高级医师",0,42,"7"),
                          ("801","王疯子","初级医师",0,21,"8"),
                          ("802","武曌","中级医师",1,25,"8"),
                          ("803","蔡子杰","初级医师",0,21,"8"),
                          ("901","谢好看","初级医师",0,21,"9"),
                          ("902","陈真帅","中级医师",1,20,"9"),
                          ("903","王猛","初级医师",1,21,"9");
insert into room values ("1101","一号楼101","1"),
                        ("1102","一号楼102","1"),
                        ("1103","一号楼103","1"),
                        ("2101","二号楼101","2"),
                        ("2102","二号楼102","2"),
                        ("2103","二号楼103","2"),
                        ("1401","一号楼401","3"),
                        ("1402","一号楼402","3"),
                        ("1403","一号楼403","3"),
                        ("1104","一号楼104","4"),
                        ("1105","一号楼105","5"),
                        ("1106","一号楼106","6"),
                        ("1407","一号楼407","7"),
                        ("1408","一号楼408","8"),
                        ("1409","一号楼409","9");
insert into patient values ("0001","赵一",1,20,"101","1101","左脚踝粉碎性骨折","2018-12-20","2019-01-28"),
                           ("0002","钱二",0,23,"201","2102","内出血","2018-11-22","2018-12-29"),
                           ("0003","竹三",0,19,"301","1401","妇科炎症","2018-12-22","2018-12-23"),
                           ("0004","李来武",1,6,"401","1104","多种抽动综合征","2018-11-10","2019-01-01"),
                           ("0005","王系民",1,52,"501","1105","帕金森综合征","2018-11-24","2018-12-25"),
                           ("0006","陈来文",0,54,"601","1106","强迫症","2018-12-15","2018-12-23"),
                           ("0007","代乘一",1,22,"701","1407","额骨骨髓炎","2018-12-24","2018-12-25"),
                           ("0008","高来基",0,34,"801","1408","核磁共振检测","2018-12-23","2018-12-26"),
                           ("0009","吴总会",0,43,"901","1409","艾滋病检测","2018-12-22","2018-12-27"),
                           ("0010","曹文龙",1,32,"102","1102","锁骨粉碎性骨折","2018-12-21","2019-01-25"),
                           ("0011","陈高轶",1,26,"202","2102","呼吸不畅","2018-12-19","2019-01-26"),
                           ("0012","陈温暖",1,29,"302","1401","子宫内膜炎","2018-12-18","2019-01-24"),
                           ("0013","牛群",0,3,"402","1104","结节性硬化","2018-12-17","2019-01-27"),
                           ("0014","李晶晶",0,61,"502","1105","老年性痴呆","2018-12-16","2019-01-28"),
                           ("0015","李沁颍",1,23,"602","1106","抑郁症","2018-12-15","2019-01-26"),
                           ("0016","刘馨雨",0,21,"702","1407","海绵窦血栓性静脉炎","2018-12-14","2019-01-25"),
                           ("0017","方子健",1,34,"802","1408","数字减影血管造影检测","2018-12-13","2019-01-26"),
                           ("0018","林威良",1,43,"902","1409","血液白细胞检测","2018-12-12","2019-01-24"),
                           ("0019","王恩琦",0,27,"103","1101","手指粉碎性骨折","2018-12-12","2019-01-26"),
                           ("0020","臧庆良",1,26,"203","2102","消化不良","2018-12-21","2019-01-29"),
                           ("0021","李欢欢",0,18,"303","1401","盆腔炎","2018-12-22","2019-01-31"),
                           ("0022","欧俊",1,6,"403","1104","小儿高热","2018-12-21","2019-01-30"),
                           ("0023","全淑敏",1,43,"503","1105","孤独症","2018-12-22","2019-01-01"),
                           ("0024","龚敬博",1,51,"603","1106","抑郁性神经症","2018-12-24","2019-01-22"),
                           ("0025","代除一",0,21,"703","1407","球后视神经炎","2018-12-23","2019-01-23"),
                           ("0026","郝凡",0,22,"803","1408","计算机X光检测","2018-12-22","2018-12-28"),
                           ("0027","黎小蓓",0,21,"903","1409","血液常规检查","2018-12-21","2018-12-22");
insert into nurse values ("01","黎晓蓓",0,21),
                         ("02","闫春竹",0,22),
                         ("03","马琳",0,23),
                         ("04","苏诗文",0,34),
                         ("05","刘颖",0,23),
                         ("06","卿菲雨",0,31),
                         ("07","徐龙",1,20),
                         ("08","曲芊羽",0,19);
insert into PN values ("0001","01","康复治疗1","2018-12-22 13:12:11"),
                      ("0002","02","康复治疗2","2018-12-23 15:12:22"),
                      ("0003","03","康复治疗3","2018-12-22 13:34:02"),
                      ("0004","04","康复治疗4","2018-12-23 14:32:23"),
                      ("0005","05","康复治疗1","2018-12-22 15:14:11"),
                      ("0006","06","康复治疗2","2018-12-23 16:14:11"),
                      ("0007","07","康复治疗3","2018-12-24 17:13:11"),
                      ("0008","08","康复治疗4","2018-12-24 18:14:11"),
                      ("0009","01","换药1","2018-12-22 19:27:21"),
                      ("0001","02","换药2","2018-12-23 12:16:14"),
                      ("0002","03","换药1","2018-12-26 13:15:15"),
                      ("0003","04","换药1","2018-12-23 14:11:15"),
                      ("0001","05","换药3","2018-12-24 15:42:16"),
                      ("0002","06","换药2","2018-12-22 16:24:17"),
                      ("0003","07","换药2","2018-12-23 17:14:18"),
                      ("0004","08","康复治疗1","2018-12-26 18:25:43"),
                      ("0005","01","康复治疗2","2018-12-24 19:52:12"),
                      ("0006","02","康复治疗3","2018-12-22 20:15:45"),
                      ("0007","03","康复治疗4","2018-12-24 21:43:34"),
                      ("0008","04","康复治疗5","2018-12-24 22:32:42"),
                      ("0009","05","康复治疗6","2018-12-22 23:23:24"),
                      ("0001","06","康复治疗7","2018-12-24 00:12:31"),
                      ("0005","07","康复治疗8","2018-12-25 01:53:41"),
                      ("0004","08","康复治疗9","2018-12-23 02:32:42");
insert into drug values("0001","注射用苄星青霉素","哈尔滨制药厂",123,24),
                       ("0002","三磷酸腺苷二钠","长春制药厂",213,34),
                       ("0003","复方氨林巴比妥注射液","沈阳制药厂",121,25),
                       ("0004","精蛋白生物合成人胰岛素注射液","北京制药厂",123,214),
                       ("0005","胞磷胆碱钠","上海制药厂",1010,28),
                       ("0006","艾司唑仑","广州制药厂",132,124),
                       ("0007","头孢氨苄","哈尔滨制药厂",12,43),
                       ("0008","异烟肼","长春制药厂",153,34),
                       ("0009","去乙酰毛花苷","北京制药厂",53,123),
                       ("0010","盐酸氟桂利嗪","广州制药厂",12,342),
                       ("0011","甲氰咪呱","哈尔滨制药厂",32,102),
                       ("0012","甲硫咪唑","广州制药厂",32,34),
                       ("0013","丁胺卡那霉素","广州制药厂",12,240),
                       ("0014","硝酸异山梨酯","哈尔滨制药厂",123,234),
                       ("0015","多潘立酮","长春制药厂",143,535),
                       ("0016","硫酸沙丁胺醇","北京制药厂",354,23),
                       ("0017","喷托维林","广州制药厂",3242,534),
                       ("0018","枸橼酸氯米芬","哈尔滨制药厂",544,53),
                       ("0019","枸橼酸他莫昔芬","广州制药厂",233,465),
                       ("0020","血塞通注射液","广州制药厂",532,42),
                       ("0021","注射用头孢替唑钠","哈尔滨制药厂",1232,23),
                       ("0022","注射用盐酸头孢替安","长春制药厂",124,27),
                       ("0023","复方愈创木酚磺酸钾口服溶液","北京制药厂",1344,23),
                       ("0024","克林霉素","广州制药厂",113,223),
                       ("0025","盐酸胺碘酮","哈尔滨制药厂",132,26),
                       ("0026","拉米夫定","广州制药厂",1030,23),
                       ("0027","头孢克肟颗粒","广州制药厂",1040,16),
                       ("0028","氟哌噻吨美利曲辛片","哈尔滨制药厂",123,53),
                       ("0029","盐酸克林霉素棕榈酸酯分散片","广州制药厂",135,53);
insert into PD values ("0001","0001",1),
                      ("0002","0001",2),
                      ("0001","0002",3),
                      ("0003","0001",1),
                      ("0004","0002",2),
                      ("0005","0001",3),
                      ("0004","0003",1),
                      ("0011","0003",2),
                      ("0005","0004",3),
                      ("0011","0022",1),
                      ("0012","0022",2),
                      ("0023","0013",3),
                      ("0023","0024",1),
                      ("0014","0022",2),
                      ("0015","0001",3),
                      ("0014","0002",1),
                      ("0021","0003",2),
                      ("0025","0004",3),
                      ("0021","0001",1),
                      ("0022","0001",2),
                      ("0021","0002",3),
                      ("0023","0003",1),
                      ("0024","0004",2),
                      ("0025","0005",3),
                      ("0024","0011",1),
                      ("0021","0021",2),
                      ("0025","0020",3),
                      ("0011","0019",1),
                      ("0022","0018",2),
                      ("0001","0017",3),
                      ("0003","0016",1),
                      ("0024","0015",2),
                      ("0015","0014",3),
                      ("0014","0013",1),
                      ("0021","0012",2),
                      ("0015","0011",3),
                      ("0006","0005",1),
                      ("0007","0005",2),
                      ("0008","0005",3),
                      ("0009","0005",1),
                      ("0010","0006",2),
                      ("0016","0006",3),
                      ("0017","0006",1),
                      ("0018","0006",2),
                      ("0019","0007",3),
                      ("0005","0007",1),
                      ("0025","0007",2),
                      ("0023","0007",3),
                      ("0024","0007",1),
                      ("0021","0008",2),
                      ("0028","0008",3),
                      ("0002","0008",1),
                      ("0001","0008",2),
                      ("0025","0009",3),
                      ("0011","0009",1),
                      ("0022","0010",2),
                      ("0001","0010",3),
                      ("0003","0010",1),
                      ("0024","0023",2),
                      ("0015","0025",3),
                      ("0014","0026",1),
                      ("0021","0027",2),
                      ("0013","0027",3),
                      ("0020","0021",1),
                      ("0007","0018",2),
                      ("0020","0018",3);
 
create procedure sl_drug_patient(in ppno char(4))
  begin
    select pname 患者姓名,illness 病症,dgname 药物名,num 数量
      from patient,drug,PD
        where patient.pno = pd.pno
          and drug.dgno = pd.dgno
            and pd.pno = ppno;
  end;
call sl_drug_patient("0001");
 
create procedure sl_doctor(in ppno char(4))
  begin
    select doctor.dname 医生姓名,doctor.duty 职务,dpname 科室名 from doctor,department
        where department.dpno = doctor.dpno
          and dno in
              (select dno from patient
               where ppno = pno);
  end;
call sl_doctor("0001");
 
create  procedure  sl_department(in ddno char(4))
begin
  select dname 医生姓名,dpname 科室名
    from department,doctor
      where department.dpno = doctor.dpno
        and doctor.dno = ddno;
end;
call sl_department("302");
 
create procedure sl_room(in ddpno char(1))
  begin
   select dpname 科室名,rno 病房编号,radr 病房地址
    from room,department
      where ddpno = room.dpno
       and room.dpno = department.dpno;
  end;
call sl_room("1");
 
create procedure sl_money(in ppno char(4))
  begin
    select sum(num * dgprice) 应缴金额
      from pd,patient,drug
        where pd.pno = patient.pno
          and drug.dgno = pd.dgno
            and patient.pno = ppno;
  end;
call sl_money("0023");
 
create procedure sl_doctor_patientnum(in ddno char(4))
  begin
    select count(*) 医生主治的患者数量 from patient
      where patient.dno = ddno;
  end;
call sl_doctor_patientnum("102");
 
create procedure sl_department_patientnum(in ddpno char(1))
  begin
    select count(*) 科室患者数 from patient,doctor,department
        where patient.dno = doctor.dno
          and department.dpno = doctor.dpno
            and ddpno = department.dpno ;
  end;
call sl_department_patientnum("2");
 
create procedure sl_department_patientname(in ddpno char(1))
  begin
    select pname 患者名,patient.pno 患者编号,dname 主治医师姓名,doctor.dno 主治医师编号
      from patient,doctor,department
        where patient.dno = doctor.dno
          and department.dpno = doctor.dpno
            and ddpno = department.dpno ;
  end;
call sl_department_patientname("1");
 
create procedure sl_nurse(in nnno char(2))
  begin
    select nno 护士编号,nname 护士姓名 from nurse
        where nno = nnno;
  end;
call sl_nurse("05");
 
create procedure sl_patient_nurse(in ppno char(4))
  begin
    select pname,illness,content,time,nname
    from nurse,patient,pn
        where nurse.nno = pn.nno
        and patient.pno = pn.pno
        and patient.pno = ppno;
  end;
call sl_patient_nurse("0002");
 
create procedure sl_patient_one_room(in ppno char(4))
  begin
    select A.pname,A.pno from patient A
        where rno in
              (select B.rno from patient B
              where B.pno=ppno);
  end;
call sl_patient_one_room("0002");
 
create procedure sl_room_patient(in rrno char(4))
  begin
    select pno,pname from patient
        where rno = rrno;
  end;
call sl_room_patient("1407");
 
create procedure del_patient(in ppno char(4))
  begin
    delete from PD where ppno = PD.pno;
    delete from patient where ppno = patient.pno;
  end;
call del_patient("0027");
 
create procedure del_drug(in ddgno char(4))
  begin
    delete from PD where ddgno = PD.dgno;
    delete from drug where ddgno = drug.dgno;
  end;
call del_drug("0029");